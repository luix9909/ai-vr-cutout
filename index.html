<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI AR Gallery - Quest 2 (بار دائم في VR)</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <style>
        body { margin: 0; direction: rtl; background: #0a0a0a; font-family: Arial; color: #e0e0e0; }
        #ui {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(15,15,20,0.92); color: #a5f3fc;
            padding: 10px; text-align: center; z-index: 9999; /* زيادة z-index عشان يبقى فوق كل شيء حتى في VR */
            border-top: 2px solid #0ea5e9; overflow-x: auto; white-space: nowrap;
            pointer-events: auto; /* مهم جدًا عشان يتقبل الضغط في VR */
        }
        .thumb {
            width: 110px; height: 150px; margin: 8px;
            object-fit: cover; border: 2px solid #0ea5e9;
            border-radius: 8px; cursor: pointer; display: inline-block;
            background: #111; box-shadow: 0 0 10px rgba(14,165,233,0.3);
        }
        button {
            padding: 10px 18px; margin: 6px; font-size: 16px;
            background: #0ea5e9; color: #000; border: none;
            border-radius: 6px; cursor: pointer; font-weight: bold;
        }
        button.delete { background: #ef4444; color: white; }
        #status { font-size: 18px; margin: 8px; color: #a5f3fc; }
        .file-input { margin: 10px auto; display: block; width: 90%; background: #111; color: #e0e0e0; padding: 8px; border: 1px solid #0ea5e9; border-radius: 6px; }
    </style>
</head>
<body>
    <div id="ui">
        <h3>معرض الملفات (مرئي دائمًا حتى في VR)</h3>
        <input type="file" id="fileInput" accept="image/*,video/*" multiple style="margin:10px;">
        <div id="thumbnails"></div>
        <div id="status">جاهز... اضغط على أي صورة/فيديو في البار لإضافتها في الغرفة (حتى وأنت في AR)</div>
        <button onclick="document.querySelector('a-scene').enterAR()">دخول AR</button>
    </div>

    <a-scene embedded renderer="alpha: true" background="transparent: true">
        <a-assets id="assets"></a-assets>

        <a-light type="ambient" intensity="0.7"></a-light>
        <a-light type="directional" position="-2 4 -2" intensity="0.5" color="#a5f3fc"></a-light>

        <a-camera position="0 1.6 0"></a-camera>
    </a-scene>

    <script>
        const scene = document.querySelector('a-scene');
        const assets = document.getElementById('assets');
        const thumbnailsDiv = document.getElementById('thumbnails');
        const status = document.getElementById('status');
        let placementCount = 0;

        // Component لتوجيه دائم للكاميرا
        AFRAME.registerComponent('always-face-camera', {
            tick: function () {
                if (scene.camera) this.el.object3D.lookAt(scene.camera.position);
            }
        });

        function addThumbnail(file) {
            const url = URL.createObjectURL(file);
            const isVideo = file.type.startsWith('video/');
            const thumb = document.createElement(isVideo ? 'video' : 'img');
            thumb.src = url;
            thumb.className = 'thumb';
            if (isVideo) {
                thumb.muted = true;
                thumb.autoplay = true;
                thumb.loop = true;
                thumb.playsinline = true;
            }

            thumb.onclick = () => {
                addEntity(url, isVideo);
                status.textContent = 'تم إضافة العنصر في الغرفة (اضغط grip للتحكم إذا أردت)';
            };

            thumbnailsDiv.appendChild(thumb);
        }

        function addEntity(url, isVideo) {
            const entity = document.createElement('a-entity');

            // توزيع بسيط أمامك (يمكن تعديله لاحقًا لدائرة)
            const x = (placementCount % 5 - 2) * 1.8;
            const z = -2.5 - Math.floor(placementCount / 5) * 1.2;
            entity.setAttribute('position', `${x} 1.4 ${z}`);

            const width = isVideo ? 1.8 : 1.6;
            const height = isVideo ? 2.4 : 2.2;

            let content = isVideo
                ? `<a-video src="${url}" width="${width}" height="${height}" loop="true" autoplay="true" playsinline="true" muted="true"></a-video>`
                : `<a-plane src="${url}" width="${width}" height="${height}" transparent="true" material="side: double; shader: flat"></a-plane>`;

            entity.innerHTML = content;
            entity.setAttribute('always-face-camera', '');

            scene.appendChild(entity);
            placementCount++;

            status.textContent = `تم إضافة ${isVideo ? 'فيديو' : 'صورة'} في الغرفة`;
        }

        document.getElementById('fileInput').addEventListener('change', (e) => {
            for (const file of e.target.files) {
                addThumbnail(file);
            }
        });

        function addFileInput() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,video/*';
            input.multiple = true;
            input.addEventListener('change', (e) => {
                for (const file of e.target.files) {
                    addThumbnail(file);
                }
            });
            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        }

        function clearAll() {
            thumbnailsDiv.innerHTML = '';
            while (scene.firstChild) {
                scene.removeChild(scene.firstChild);
            }
            placementCount = 0;
            status.textContent = 'تم مسح كل شيء';
        }
    </script>
</body>
</html>
